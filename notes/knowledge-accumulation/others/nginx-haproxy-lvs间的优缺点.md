# 概括

三者都是建立在网络结构上的负载均衡技术的软件实现。它提供了一种廉价有效透明的方法来扩展网络设备和服务器的`带宽`、`增加吞吐量`、`加强网络数据处理能力`，同时能够提高网络的灵活性和可用性。

## nginx优点

1、 工作在OSI(Open System Interconnect 简称OSI，中文为：开放系统互连参考模型)的第七层，即应用层，可以对http的应用做一些分流的策略，比如域名、请求的URI等，拥有强大的正则匹配规则，比HAproxy更为强大和灵活，Nginx单凭这点可利用的场合就远多于LVS。

2、 nginx对网络稳定性的依赖非常小，理论上能ping通就就能进行负载功能，而LVS对网络稳定性的依赖比较大。

3、 nginx调试简单，错误日志输出比较完整，而LVS排错时需要考虑较多的网络相关知识。

4、 可以承担高负载的压力且稳定，较LVS，nginx需要较高的硬件配置，且负载度要比LVS相对小些。

5、 nginx的健康检测机制可以检测到服务器内部的故障，比如根据服务器处理网页返回的状态码、超时等等，并且会把返回错误的请求重新提交到另一个节点。而LVS的技术原理决定了检测到服务器错误后不能重发请求。比如用户正在上传一个文件，而处理该上传的节点刚好在上传过程中出现故障，Nginx会把上传切到另一台服务器重新处理，而LVS就直接断掉了，如果是上传一个很大的文件或者很重要的文件的话，用户可能会因此而恼火。

6、 Nginx对请求的异步处理可以帮助节点服务器减轻负载

7、 nginx不仅可以作为负载均衡器，还可以作为缓存加速器、静态网页和图片服务器，且性能相应好。

8、 社区活跃，第三方模块众多。

## nginx的缺点

如果真要说nginx的缺点的话，那以下几点可以算是它的缺点：

1、 Nginx仅能支持http、https和email协议，适用范围相对小一些。

2、 原生nginx对后端服务器的健康检查，只支持通过端口来检测，不支持url来检测后端的服务器，但可以通过导入第三方模块解决([nginx_upstream_check_module](https://github.com/yaoweibin/nginx_upstream_check_module))。

3、 在session的保持上，原生的nginx只支持`ip_hash`，但能通过第三方模块实现根据URL和cookie来做session保持，粒度更细一些。


## LVS优点

1、 抗负载能力强，是工作在网络4层之上的仅作分发之用，数据不会进入用户空间，没有流量产生，数据的分发在内核空间完成，对内存和cpu资源的占用比较低。

2、 可配置性较低，这是一个缺点也是一个优点，因为没有太多的配置项，所以LVS集群正常工作后并不需要太多人为接触，大大减少了人为的出错几率。

3、 自身有完善的双机热备方案，如： LVS + keepalived。

4、 因工作在应用层，不关心上层协议，所以应用范围方，包括： http、数据库等。

## LVS缺点

1、 本身不支持正则表达式处理，对网站的动静分离，LVS无能为力。

2、 如果LVS的运用达到一定的规模后，在线维护有一定的复杂性，需要考虑到采用的算法、后端单个real server的负载能力及维护对网络带来的网络波动。


## HAproxy的特点

1、 HAproxy在session的保持上比nginx做得更为精细，可以利用cookie来做引导，同时支持通过获取指定的url来检测后端服务器的状态。

2、 HAproxy与LVS类似，本身就是一款负载均衡器，它同时可以对TCP和http协议进行负载（从nginx1.7.7开始也加入了TCP协议的支持，但是商用版本，社区版可打补丁实现）,因支持TCP，所以可以对MySQL读进行负载均衡，对后端的MySQL节点进行检测和负载均衡。

3、 HAproxy负载均衡策略有8种之多：
```
① roundrobin，表示简单的轮询，这个不多说，这个是负载均衡基本都具备的；
② static-rr，表示根据权重，建议关注；
③ leastconn，表示最少连接者先处理，建议关注；
④ source，表示根据请求源IP，这个跟Nginx的IP_hash机制类似，我们用其作为解决session问题的一种方法，建议关注；
⑤ ri，表示根据请求的URI；
⑥ rl_param，表示根据请求的URl参数’balance url_param’ requires an URL parameter name；
⑦ hdr(name)，表示根据HTTP请求头来锁定每一次HTTP请求；
⑧ rdp-cookie(name)，表示根据据cookie(name)来锁定并哈希每一次TCP请求。
```

HAproxy没有什么比较明显的缺点。
